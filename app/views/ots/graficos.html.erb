<%# app/views/ots/graficos.html.erb %>
<% content_for :title, "OTs · Gráficos" %>

<h1 class="h3 mb-3">Gráficos de OTs</h1>
<p><%= link_to "← Volver a OTs", ots_path, class: "btn btn-sm btn-outline-secondary" %></p>

<div class="row g-3">
  <%# ----- Fila 1: Tipo OT, Estado ----- %>
  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Tipo OT (porcentaje)",
        canvas_id: "tipoOtDonut",
        labels: @tipo_labels,
        values: @tipo_values %>
  </div>

  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Estado (porcentaje)",
        canvas_id: "estadoDonut",
        labels: @estado_labels,
        values: @estado_values %>
  </div>

  <%# ----- Fila 2: Cumplimientos por especialidad (MM/ME/MI) ----- %>
  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Cumplimiento Mecánico (MM)",
        canvas_id: "cumplimientoMM",
        labels: @mm_labels,
        values: @mm_values %>
  </div>

  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Cumplimiento Eléctrico (ME)",
        canvas_id: "cumplimientoME",
        labels: @me_labels,
        values: @me_values %>
  </div>

  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Cumplimiento Instrumentación (MI)",
        canvas_id: "cumplimientoMI",
        labels: @mi_labels,
        values: @mi_values %>
  </div>
</div>
<div class="row g-3 mb-3">
  <div class="col-12">
    <%= render "bar_chart",
        title: "Gasto total por semana",
        canvas_id: "gastoSemanalBar",
        labels: @semana_labels,
        values: @semana_totales %>
  </div>
</div>

<div class="row g-3 mb-3">
  <div class="col-md-6">
    <%= render "stacked_bar_chart",
      title: "OT por semana: Estado 70 vs Otros estados",
      canvas_id: "otEstado70VsRestoPorSemana",
      labels: @semana_labels_70split,
      datasets: [
        { label: "Estado 70", data: @cant_70_por_semana },
        { label: "Otros estados",     data: @cant_resto_por_semana }
      ],
      format: :count %>
  </div>

  <div class="col-md-6">
  <%= render "stacked_bar_chart",
    title: "OT por semana: A+C+F vs U+I",
    canvas_id: "otGruposPorSemana",
    labels: @semana_labels_tipo,
    datasets: [
      { label: "A+C+F", data: @cant_acf_por_semana },
      { label: "U+I",   data: @cant_ui_por_semana }
    ],
    format: :count %>
</div>

</div>


<div class="row g-3 mb-3">
  <div class="col-12">
    <%= render "stacked_bar_chart",
      title: "Gasto por semana (Servicio 85/≠85 y Repuestos ≥57/<57)",
      canvas_id: "gasto4CategoriasPorSemana",
      labels: @semana_labels_gasto4,
      datasets: [
        { label: "Servicio (Estado 85)",   data: @gasto_svc_85 },
        { label: "Servicio (Estado ≠85)",  data: @gasto_svc_not_85 },
        { label: "Repuestos (Estado ≥57)", data: @gasto_rep_ge_57 },
        { label: "Repuestos (Estado <57)", data: @gasto_rep_lt_57 }
      ],
      format: :currency %>
  </div>
</div>

</div>



<%= render "kpis" %>

<%# app/views/ots/graficos.html.erb %>
<% content_for :title, "OTs · Gráficos" %>

<h1 class="h3 mb-3">Gráficos de OTs</h1>
<p><%= link_to "← Volver a OTs", ots_path, class: "btn btn-sm btn-outline-secondary" %></p>

<div class="row g-3">
  <%# ----- Fila 1: Tipo OT, Estado ----- %>
  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Tipo OT (porcentaje)",
        canvas_id: "tipoOtDonut",
        labels: @tipo_labels,
        values: @tipo_values %>
  </div>

  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Estado (porcentaje)",
        canvas_id: "estadoDonut",
        labels: @estado_labels,
        values: @estado_values %>
  </div>

  <%# ----- Fila 2: Cumplimientos por especialidad (MM/ME/MI) ----- %>
  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Cumplimiento Mecánico (MM)",
        canvas_id: "cumplimientoMM",
        labels: @mm_labels,
        values: @mm_values %>
  </div>

  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Cumplimiento Eléctrico (ME)",
        canvas_id: "cumplimientoME",
        labels: @me_labels,
        values: @me_values %>
  </div>

  <div class="col-md-6 col-xl-4">
    <%= render "donut_chart",
        title: "Cumplimiento Instrumentación (MI)",
        canvas_id: "cumplimientoMI",
        labels: @mi_labels,
        values: @mi_values %>
  </div>
</div>
<div class="row g-3 mb-3">
  <div class="col-12">
    <%= render "bar_chart",
        title: "Gasto total por semana",
        canvas_id: "gastoSemanalBar",
        labels: @semana_labels,
        values: @semana_totales %>
  </div>
</div>

<div class="row g-3 mb-3">
  <div class="col-md-6">
    <%= render "bar_chart",
      title: "OT en estado 70 por semana",
      canvas_id: "otEstado70PorSemana",
      labels: @semana_labels_70,
      values: @semana_cant_70 %>
  </div>

  <div class="col-md-6">
    <%= render "bar_chart",
      title: "OT tipo A por semana",
      canvas_id: "otTipoAPorSemana",
      labels: @semana_labels_tipoA,
      values: @semana_cant_tipoA %>
  </div>
</div>

<div class="row g-3 mb-3">
  <div class="col-12">
  <%= render "stacked_bar_chart",
  title: "Gasto por semana: estado 85 vs resto",
  canvas_id: "gastoSplitPorSemana",
  labels: @semana_labels_gasto_split,
  datasets: [
    { label: "Estado 85", data: @gasto_85 },
    { label: "Resto",     data: @gasto_rest }
  ] %>

  </div>
</div>



<%= render "kpis" %>
